<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <style>
    body {
      margin: 0px;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <div id="container"></div>
  <script src="../three.min.js"></script>
  <script type="text/javascript" language="JavaScript1.5"
      src="https://rawgit.com/Vasilui/habrahabr/master/WebGL_Three.js/libs/stats.js"></script>
  <script type="text/javascript" language="JavaScript1.5"
      src="https://rawgit.com/Vasilui/habrahabr/master/WebGL_Three.js/libs/dat.gui.js"></script>
  <script type="text/javascript" src="../jquery-1.8.0.min.js"></script>
  <script src="../TrackballControls.js"></script>
  <script src="../webaudiox.js"></script>
  <div id="WebGL-output"></div>

    <script id="vertexShader" type="x-shader/x-vertex">

    </script>

    <script id="fragmentShader" type="x-shader/x-fragment">
      #ifdef GL_ES
      precision mediump float;
      #endif
      uniform float time;
      uniform vec2 mouse;
      uniform vec2 resolution;

      void main( void ) {
      	const float span = 5.;
      	const float r = span / 2.;
      	vec3 color;
      	vec2 uv = (gl_FragCoord.xy * 2. - resolution) / resolution.y;
      	uv *= 250.;
      	float zt = -9e9;
      	float zb = 9e9;

      	for (float y = -180.; y <= 180.; y += span) {
      		float x = (floor(uv.x / span) + .5) * span + y / 2.;
      		if (abs(x) > 180.) continue;

      		float t = radians(length(vec2(x, y)));
      		t *= sin(time * .2) * 3.;
          //		t -= time;
      		float z = (cos(t) * 100. - cos(t * 3.) * 30.) + y / 2.;
      		vec2 p = vec2(x - y / 2., z);
      		float d = distance(uv, p) / r - 1.;
      		if (d <= 0.) {
      			if (z < zb || zt < z) {
      				color = vec3(1, 2, 0) * -d;
      			}
      			break;
      		}
      		zt = max(zt, z);
      		zb = min(zb, z);
      	}
      	gl_FragColor = vec4(color, 1);
      }
    </script>
  <script>
    var container;
    var camera, scene, renderer;
    var uniforms, material, mesh;
    var mouseX = 0, mouseY = 0,
      lat = 0, lon = 0, phy = 0, theta = 0;

    var windowHalfX = window.innerWidth / 2;
    var windowHalfY = window.innerHeight / 2;
    var startTime = Date.now();

    uniforms = {};
    uniforms.resolution = {type: 'v2', value: new THREE.Vector2(window.innerWidth, window.innerHeight)};
    uniforms.time = {type: 'f', value: startTime};
    uniforms.mouse = {type: 'v2', value: new THREE.Vector2()}

    document.onmousemove = function(event) {
      uniforms.mouse.value.x = event.clientX;
      uniforms.mouse.value.y = event.clientY;
    }

    init();

    animate();


    function init() {
      container = document.getElementById('container');

      camera = new THREE.PerspectiveCamera(75,
          window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.z = 20;
      scene = new THREE.Scene();

      material = new THREE.ShaderMaterial({
        uniforms: uniforms,
        fragmentShader: document.getElementById('fragmentShader').textContent
      });

      mesh = new THREE.Mesh(new THREE.PlaneGeometry(10, 10), material);
      scene.add(mesh);

      renderer = new THREE.WebGLRenderer();
      renderer.setPixelRatio(window.devicePixelRatio ? window.devicePixelRatio : 1);
      container.appendChild(renderer.domElement);

      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
      requestAnimationFrame(animate);
      render();
    }

    function render() {

      startTime += 0.005
      uniforms.time.value = startTime;
      uniforms.resolution.value.x = window.innerWidth;
      uniforms.resolution.value.y = window.innerHeight;
      renderer.render(scene, camera);
    }
  </script>
</body>

</html>
